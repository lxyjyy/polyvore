<!DOCTYPE html>
<html lang="zh-tw">
  <head>
    <meta charset="utf-8">
    <title>Polyvore Clone</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.5.0/fabric.min.js"></script>
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
<body>
<div class="row" style="padding-top:10px">
	<div class="col-lg-1 col-md-1"></div>
	<div class="col-lg-3 col-md-3">
		<h1>Source</h1>
		<canvas id="c" width="400px" height="400px" style="border:1px inset"></canvas><br>
		<input type="file" id="imgLoader"></input><br>
		<button class="btn" onclick="show()">Show Data</button>
	</div>

        <div class="col-lg-3 col-md-3">
		<h1>Canvas Copy</h1>
		<canvas id="c2" width="400px" height="400px" style="border:1px inset"></canvas><br>
	</div>
        <div class="col-lg-3 col-md-3">
		<h1>Generate PNG</h1>
		<img id="canvasImg" style="float:left;border:5px solid transparent;"> </img>
	</div>
	<div class="col-lg-1 col-md-1"></div>

</div>
</body>
</html>
<script>
canvas = new fabric.Canvas('c');
canvas2 = new fabric.Canvas('c2');
document.getElementById('imgLoader').onchange = function handleImage(e) {
    var reader = new FileReader();
    reader.onload = function (event) { 
        var imgObj = new Image();
        imgObj.src = event.target.result;
        imgObj.onload = function () {
            // start fabricJS stuff
            
            var image = new fabric.Image(imgObj);
            image.set({
                left: 150,
                top: 150,
                angle: 0,
                padding: 10,
                cornersize: 10
            });
            canvas.add(image);
            
            // end fabricJS stuff
        }
        
    }
    reader.readAsDataURL(e.target.files[0]);
    console.log(JSON.stringify(canvas));
    canvas.on('mouse:over_', function(e) {
        alert("商品資訊");
	canvas.renderAll();
    });
}

function show(){
	var json = JSON.stringify( canvas );
    	//alert(json);
	//Create img
	var dataURL = canvas.toDataURL();
	document.getElementById('canvasImg').src = dataURL;

	//Create Canvas2
	canvas2.clear();
	canvas2.loadFromJSON(json, canvas.renderAll.bind(canvas2));
}

//Delete Selected Fabric Obj
$(window).keydown(function(e) {    
    switch (e.keyCode) {
        case 46: // when press delete
	if(canvas.getActiveGroup()){
      		canvas.getActiveGroup().forEachObject(function(o){ canvas.remove(o) });
      		canvas.discardActiveGroup().renderAll();
    	} else {
      		canvas.remove(canvas.getActiveObject());
    	}        
    }
});

</script>

